The function `local_doc_chat` is an asynchronous endpoint handler for processing user queries against a local knowledge base. It first validates the user ID and checks the existence of specified knowledge bases. If the knowledge bases exist, it retrieves and filters relevant documents. The function can operate in either streaming or non-streaming mode to generate responses based on the user's query. In streaming mode, it sends partial answers incrementally, while in non-streaming mode, it sends a complete response. The function logs various stages of processing and returns a JSON response containing the query result, history, and source documents.